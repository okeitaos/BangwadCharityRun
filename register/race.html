<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üèÉ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≠‡∏ö ‚Äî ‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏ó‡πá‡∏Å</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Prompt', sans-serif; }
  .fade-in { animation: fadeIn 0.5s ease-in; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px);} to { opacity: 1; transform: translateY(0);} }
</style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-6">
  <h1 class="text-2xl font-bold text-center mb-4">üèÅ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡∏£‡∏≠‡∏ö‡∏ß‡∏¥‡πà‡∏á</h1>

  <div class="mb-4">
    <label for="tagInput" class="block text-sm text-gray-600 mb-1">‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å Tag ID</label>
    <div class="flex gap-2">
      <input id="tagInput" type="text" inputmode="numeric" autocomplete="off"
        placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πÅ‡∏Å‡∏ô Tag ID..."
        class="flex-grow border rounded-md px-3 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-blue-400" autofocus>
      <button id="scanBtn" class="bg-blue-600 text-white px-5 rounded-md font-medium text-sm">‡∏™‡πÅ‡∏Å‡∏ô</button>
    </div>
  </div>

  <div class="flex justify-center gap-2 mb-4">
    <button data-type="TOP100MEN" class="type-btn bg-blue-500 text-white px-4 py-2 rounded-md flex-1">MEN</button>
    <button data-type="TOP100WOMEN" class="type-btn bg-pink-500 text-white px-4 py-2 rounded-md flex-1">WOMEN</button>
  </div>

  <div id="statusBox" class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-center min-h-[80px]">
    <p id="status" class="text-gray-600 text-sm">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô</p>
  </div>

  <footer class="mt-4 text-xs text-gray-500 text-center">
    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏ó‡πá‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<br>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ / ‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï
  </footer>
</div>

<script>
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics"; // üëà ‡πÉ‡∏™‡πà anon key
const FUNCTION_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co/functions/v1/rfid-reader";

const tagInput = document.getElementById("tagInput");
const scanBtn = document.getElementById("scanBtn");
const statusEl = document.getElementById("status");
let currentType = "TOP100MEN";

document.querySelectorAll(".type-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    currentType = btn.dataset.type;
    document.querySelectorAll(".type-btn").forEach(b => b.classList.remove("ring-4","ring-blue-300"));
    btn.classList.add("ring-4","ring-blue-300");
    statusEl.textContent = `‡πÇ‡∏´‡∏°‡∏î: ${currentType === "TOP100MEN" ? "MEN" : "WOMEN"}`;
  });
});

scanBtn.onclick = () => handleScan(tagInput.value.trim());
tagInput.addEventListener("keydown", e => { if (e.key === "Enter") handleScan(tagInput.value.trim()); });

async function handleScan(tagId) {
  if (!tagId) return;
  try {
    statusEl.textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
    scanBtn.disabled = tagInput.disabled = true;

    const resp = await fetch(FUNCTION_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${SUPABASE_KEY}`
      },
      body: JSON.stringify({ tag_id: tagId })
    });

    const result = await resp.json();
    const box = document.getElementById("statusBox");
    box.classList.add("fade-in");

    if (result.error) {
      box.className = "bg-red-50 border border-red-300 rounded-lg p-4 text-center fade-in";
      statusEl.innerHTML = `‚ùå ${result.error}`;
    } else if (result.message) {
      box.className = "bg-yellow-50 border border-yellow-300 rounded-lg p-4 text-center fade-in";
      statusEl.innerHTML = `‚ö†Ô∏è ${result.message}`;
    } else {
      box.className = "bg-green-50 border border-green-300 rounded-lg p-4 text-center fade-in";
      statusEl.innerHTML = `‚úÖ ${result.runner}<br>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${result.lap}<br><span class='text-xs text-gray-500'>${result.time}</span>`;
    }

    tagInput.value = "";
  } catch (err) {
    statusEl.textContent = "‚ùå Error: " + err.message;
  } finally {
    scanBtn.disabled = tagInput.disabled = false;
    tagInput.focus();
  }
}
</script>
</body>
</html>
