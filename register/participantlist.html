<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£ | Bangwad Charity Run</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body {
    font-family: "Prompt", sans-serif;
    background: #0f172a;
    color: #fff;
    padding: 20px;
    text-align: center;
  }

  h1 {
    color: #facc15;
    margin-bottom: 20px;
  }

  input {
    width: 90%;
    max-width: 360px;
    padding: 12px;
    margin: 10px 0;
    border-radius: 10px;
    border: none;
    background: rgba(255,255,255,0.1);
    color: #fff;
    text-align: center;
    font-size: 1rem;
  }

  button {
    background: #3b82f6;
    color: #fff;
    padding: 12px 25px;
    border-radius: 25px;
    border: none;
    font-size: 1rem;
    font-weight: bold;
    margin-top: 10px;
    cursor: pointer;
  }

  button:hover { opacity: 0.85; }

  .card {
    background: rgba(255,255,255,0.08);
    padding: 20px;
    margin-top: 20px;
    border-radius: 15px;
    max-width: 420px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
    line-height: 1.6;
  }

  .label { color: #facc15; font-weight: bold; }

  .slip {
    width: 100%;
    max-width: 320px;
    margin-top: 10px;
    border-radius: 10px;
  }

  .status-approved { color: #4ade80; font-weight: bold; }
  .status-pending { color: #facc15; font-weight: bold; }
  .status-rejected { color: #ef4444; font-weight: bold; }
</style>
</head>

<body>

<h1>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h1>
<p>‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏•‡∏Ç Passport</p>

<input type="text" id="nationalId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ / Passport">
<button onclick="searchData()" id="searchBtn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>

<div id="result"></div>

<script>
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co";
const SUPABASE_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢‡πÅ‡∏ö‡∏ö 100% */
function formatThaiTime(dateString) {
  return new Intl.DateTimeFormat("th-TH", {
    dateStyle: "short",
    timeStyle: "medium",
    timeZone: "Asia/Bangkok"
  }).format(new Date(dateString));
}

async function searchData() {
  const nationalId = document.getElementById("nationalId").value.trim();
  const result = document.getElementById("result");

  if (!nationalId) {
    result.innerHTML = `<p style="color:#ef4444;">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç Passport</p>`;
    return;
  }

  result.innerHTML = `<p style="color:#facc15;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</p>`;

  // ‚úî ‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß national_id
  //   ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ï‡∏£ + passport
  const { data, error } = await sb
    .from("bangwad")
    .select("*")
    .eq("national_id", nationalId)
    .maybeSingle();

  if (error || !data) {
    result.innerHTML = `<p style="color:#ef4444;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ</p>`;
    return;
  }

  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  let statusColor = "status-pending";
  if (data.status === "approved") statusColor = "status-approved";
  if (data.status === "rejected") statusColor = "status-rejected";

  result.innerHTML = `
    <div class="card">
      <p><span class="label">‡∏ä‡∏∑‡πà‡∏≠:</span> ${data.first_name} ${data.last_name}</p>
      <p><span class="label">‡∏≠‡∏≤‡∏¢‡∏∏:</span> ${data.age}</p>
      <p><span class="label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span> ${data.phone}</p>
      <p><span class="label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</span> ${data.email}</p>
      <p><span class="label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</span> ${data.category}</p>
      <p><span class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</span> <span class="${statusColor}">${data.status}</span></p>

      <p><span class="label">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠:</span> ${formatThaiTime(data.created_at)}</p>

      ${data.slip_url ? `<img src="${data.slip_url}" class="slip">` : ""}
    </div>
  `;
}
</script>

</body>
</html>
