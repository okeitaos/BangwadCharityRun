<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡πà‡∏á | 4LAPTOP100 Registration</title>
<style>
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #0f172a, #1e293b, #0f172a); 
    color:#fff; margin:0; padding:20px; min-height:100vh;
    display:flex; justify-content:center; align-items:center;
  }
  form.container {
    position: relative; width:100%; max-width:540px;
    background: rgba(255,255,255,0.05); border-radius:20px; padding:28px;
    backdrop-filter: blur(12px); box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    border:1px solid rgba(255,255,255,0.08); text-align:left;
  }
  .logo { display:block; margin:0 auto 12px auto; width:66px; height:66px; }
  h1 { text-align:center; font-size:1.6rem; color:#facc15; margin-bottom:4px;}
  h2 { text-align:center; font-size:0.95rem; color:#cbd5e1; margin-bottom:14px; }
  label { display:block; font-weight:600; margin-bottom:6px; margin-top:12px; font-size:0.95rem; }
  .row { display:flex; gap:10px; align-items:center; }
  input, select {
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.06); color:#fff; font-size:0.96rem; outline:none;
    transition: all 0.18s ease; box-sizing:border-box;
  }
  input:focus, select:focus { border-color:#facc15; box-shadow:0 3px 12px rgba(250,204,21,0.12); }
  .small { width:130px; }
  .inline { display:flex; gap:8px; }
  .hint { font-size:0.85rem; color:#ffd; margin-top:6px; }
  .error { font-size:0.85rem; color:#ff7b7b; margin-top:6px; white-space:pre-line; }
  button#submitBtn {
    display:block; width:100%; padding:12px; margin-top:18px;
    background: linear-gradient(90deg,#facc15,#f59e0b); border:none; border-radius:12px;
    cursor:pointer; font-size:1rem; font-weight:700; color:#111;
  }
  button#submitBtn:disabled { opacity:0.6; cursor:not-allowed; transform:none; }
  #loading { display:none; text-align:center; margin-top:8px; font-style:italic; color:#cbd5e1; }

  .lang-switch {
    position:absolute; top:12px; right:12px; background:#facc15; color:#000;
    border:none; padding:6px 12px; border-radius:20px; cursor:pointer; font-weight:700;
    font-size:0.85rem; display:flex; align-items:center; gap:6px;
  }
  .lang-switch:hover { transform:scale(1.02); }

  #resultModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:999; }
  .modal-content { background:#fff; color:#000; padding:20px; border-radius:14px; width:92%; max-width:420px; text-align:center; }
  .close-btn { position:absolute; top:8px; right:8px; background:#ef4444; color:#fff; border:none; border-radius:50%; width:34px; height:34px; cursor:pointer; font-weight:bold; }
  .close-btn:hover { background:#dc2626; }

  @media (max-width:520px){
    form.container { padding:18px; }
    .small { width:110px; }
  }

  input, select {
    width:100%;
    padding:12px 14px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.08);
    color:#fff;
    font-size:0.95rem;
    outline:none;
    transition: all 0.2s ease;
    box-sizing:border-box;
  }
  input:focus, select:focus {
    border-color:#facc15;
    background: rgba(255,255,255,0.12);
    box-shadow:0 0 0 3px rgba(250,204,21,0.25);
  }
  label {
    font-weight:600;
    margin-bottom:6px;
    display:block;
    font-size:0.92rem;
    color:#fefefe;
  }

  .doc-row {
    display:flex;
    gap:12px;
    margin-top:14px;
  }
  .doc-row > div {
    flex:1;
    display:flex;
    flex-direction:column;
  }
  #idHint {
    font-size:0.8rem;
    color:#e0e0a0;
    margin-top:4px;
  }
  #idError {
    font-size:0.8rem;
    color:#ff6b6b;
    margin-top:4px;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>

<form class="container" id="registerForm" novalidate>
  <button type="button" class="lang-switch" id="langToggleBtn" onclick="toggleLang()">
    <span id="langFlag">üáπüá≠</span> <span id="langText">TH</span>
  </button>

  <img src="https://lh5.googleusercontent.com/d/1NsdMoUCj_UIYhxXhB-I71h1km9v6W1rR" class="logo" alt="Logo">
  <h1 id="formTitle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡πà‡∏á</h1>
  <h2 id="formSubtitle">4LAPTOP100</h2>

  <label id="labelFirstName">‡∏ä‡∏∑‡πà‡∏≠</label>
  <input type="text" id="firstName" required>

  <label id="labelLastName">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
  <input type="text" id="lastName" required>

  <div class="doc-row">
  <div>
    <label id="labelIdType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
    <select id="idType">
      <option value="auto">Auto-detect</option>
      <option value="thaiid">‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</option>
      <option value="passport">Passport</option>
    </select>
  </div>
  <div>
    <label id="labelNationalId">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / Passport</label>
    <input type="text" id="nationalId" autocomplete="off" inputmode="text"/>
    <div id="idHint" class="hint"></div>
    <div id="idError" class="error" style="display:none"></div>
  </div>
</div>

  <label id="labelPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
  <input type="tel" id="phone" maxlength="10" required>

  <label id="labelEmail">Email</label>
  <input type="email" id="email" required>

  <label id="labelAge">‡∏≠‡∏≤‡∏¢‡∏∏</label>
  <input type="number" id="age" min="1" max="99" required>

  <label id="labelShirtSize" style="display:none;">‡πÑ‡∏ã‡∏™‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠ / Shirt Size</label>
  <select id="shirtSize" style="display:none;">
  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ã‡∏™‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠ --</option>
  <option value="XS">XS 34"</option>
  <option value="S">S 36"</option>
  <option value="M">M 38"</option>
  <option value="L">L 40"</option>
  <option value="XL">XL 42"</option>
  <option value="2XL">2XL 44"</option>
  <option value="3XL">3XL 46"</option>
  <option value="4XL">4XL 48"</option>
</select>

  <label id="labelCategory">‡∏£‡∏∏‡πà‡∏ô‡∏≠‡∏≤‡∏¢‡∏∏/‡πÄ‡∏û‡∏®</label>
  <select id="category" required>
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô --</option>
  </select>

  <label id="labelSlip">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
  <input type="file" id="slip" accept="image/*" required>

  <button type="submit" id="submitBtn">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
  <div id="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</div>
</form>

<div id="resultModal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal()">√ó</button>
    <h2 id="modalTitle">‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ</h2>
    <p id="resultText" style="white-space:pre-line; text-align:left;"></p>
    <img id="slipPreview" src="" alt="slip" style="max-width:220px; border-radius:8px; margin-top:8px;">
    <div style="margin-top:12px;">
      <button onclick="closeModal()" style="background:#3b82f6;color:#fff;padding:8px 14px;border-radius:8px;border:none;">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let categoriesData = [];
let currentLang = "TH";

function isValidThaiId(id){
  if(!/^\d{13}$/.test(id)) return false;
  let sum=0;
  for(let i=0;i<12;i++) sum+=parseInt(id.charAt(i),10)*(13-i);
  return (11-sum%11)%10===parseInt(id.charAt(12),10);
}
function isPassportFormat(val){ if(/^\d{13}$/.test(val)) return false; return /^[A-Za-z0-9]{6,15}$/.test(val);}
function detectIdTypeByValue(val){ if(isValidThaiId(val))return"thaiid"; if(isPassportFormat(val))return"passport"; return null; }

/* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• */
function isValidEmail(email){
  const re=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
  return re.test(email);
}

/* ...TEXT object ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î... */

/* ====== Submit handler ====== */
document.getElementById("registerForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const firstName=document.getElementById("firstName").value.trim();
  const lastName=document.getElementById("lastName").value.trim();
  const rawId=document.getElementById("nationalId").value.trim();
  const phone=document.getElementById("phone").value.trim();
  const email=document.getElementById("email").value.trim();
  const age=document.getElementById("age").value.trim();
  const shirtSize=document.getElementById("shirtSize").value;
  const category=document.getElementById("category").value;
  const slipFile=document.getElementById("slip").files[0];
  const t=TEXT[currentLang];

  if(!firstName||!lastName||!rawId||!phone||!email||!age||!category||!slipFile){ alert(t.fillFields); return; }

  /* ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ */
  if(!isValidEmail(email)){
    alert(currentLang==="TH"?"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô example@gmail.com":"Please enter a valid email address (e.g. example@gmail.com)");
    return;
  }

  // (‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ã‡πâ‡∏≥, upload slip, insert Supabase ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
});
</script>
</body>
</html>
