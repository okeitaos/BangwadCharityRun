<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡πà‡∏á | 4LAPTOP100 Registration</title>
<style>
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #0f172a, #1e293b, #0f172a); 
    color:#fff; margin:0; padding:20px; min-height:100vh;
    display:flex; justify-content:center; align-items:center;
  }
  form.container {
    position: relative; width:100%; max-width:540px;
    background: rgba(255,255,255,0.05); border-radius:20px; padding:28px;
    backdrop-filter: blur(12px); box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    border:1px solid rgba(255,255,255,0.08); text-align:left;
  }
  .logo { display:block; margin:0 auto 12px auto; width:66px; height:66px; }
  h1 { text-align:center; font-size:1.6rem; color:#facc15; margin-bottom:4px;}
  h2 { text-align:center; font-size:0.95rem; color:#cbd5e1; margin-bottom:14px; }
  label { display:block; font-weight:600; margin-bottom:6px; margin-top:12px; font-size:0.95rem; }
  .row { display:flex; gap:10px; align-items:center; }
  input, select {
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.06); color:#fff; font-size:0.96rem; outline:none;
    transition: all 0.18s ease; box-sizing:border-box;
  }
  input:focus, select:focus { border-color:#facc15; box-shadow:0 3px 12px rgba(250,204,21,0.12); }
  .small { width:130px; }
  .inline { display:flex; gap:8px; }
  .hint { font-size:0.85rem; color:#ffd; margin-top:6px; }
  .error { font-size:0.85rem; color:#ff7b7b; margin-top:6px; white-space:pre-line; }
  button#submitBtn {
    display:block; width:100%; padding:12px; margin-top:18px;
    background: linear-gradient(90deg,#facc15,#f59e0b); border:none; border-radius:12px;
    cursor:pointer; font-size:1rem; font-weight:700; color:#111;
  }
  button#submitBtn:disabled { opacity:0.6; cursor:not-allowed; transform:none; }
  #loading { display:none; text-align:center; margin-top:8px; font-style:italic; color:#cbd5e1; }

  .lang-switch {
    position:absolute; top:12px; right:12px; background:#facc15; color:#000;
    border:none; padding:6px 12px; border-radius:20px; cursor:pointer; font-weight:700;
    font-size:0.85rem; display:flex; align-items:center; gap:6px;
  }
  .lang-switch:hover { transform:scale(1.02); }

  #resultModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:999; }
  .modal-content { background:#fff; color:#000; padding:20px; border-radius:14px; width:92%; max-width:420px; text-align:center; }
  .close-btn { position:absolute; top:8px; right:8px; background:#ef4444; color:#fff; border:none; border-radius:50%; width:34px; height:34px; cursor:pointer; font-weight:bold; }
  .close-btn:hover { background:#dc2626; }

  @media (max-width:520px){
    form.container { padding:18px; }
    .small { width:110px; }
  }

  .doc-row {
    display:flex;
    gap:12px;
    margin-top:14px;
  }
  .doc-row > div {
    flex:1;
    display:flex;
    flex-direction:column;
  }
  #idHint { font-size:0.8rem; color:#e0e0a0; margin-top:4px; }
  #idError { font-size:0.8rem; color:#ff6b6b; margin-top:4px; }
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>

<form class="container" id="registerForm" novalidate>
  <button type="button" class="lang-switch" id="langToggleBtn" onclick="toggleLang()">
    <span id="langFlag">üáπüá≠</span> <span id="langText">TH</span>
  </button>

  <img src="https://lh5.googleusercontent.com/d/1NsdMoUCj_UIYhxXhB-I71h1km9v6W1rR" class="logo" alt="Logo">
  <h1 id="formTitle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡πà‡∏á</h1>
  <h2 id="formSubtitle">4LAPTOP100</h2>

  <label id="labelFirstName">‡∏ä‡∏∑‡πà‡∏≠</label>
  <input type="text" id="firstName" required>

  <label id="labelLastName">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
  <input type="text" id="lastName" required>

  <div class="doc-row">
  <div>
    <label id="labelIdType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
    <select id="idType">
      <option value="auto">Auto-detect</option>
      <option value="thaiid">‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</option>
      <option value="passport">Passport</option>
    </select>
  </div>
  <div>
    <label id="labelNationalId">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / Passport</label>
    <input type="text" id="nationalId" autocomplete="off" inputmode="text"/>
    <div id="idHint" class="hint"></div>
    <div id="idError" class="error" style="display:none"></div>
  </div>
</div>

  <label id="labelPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
  <input type="tel" id="phone" maxlength="10" required>

  <label id="labelEmail">Email</label>
  <input type="email" id="email" required>

  <label id="labelAge">‡∏≠‡∏≤‡∏¢‡∏∏</label>
  <input type="number" id="age" min="1" max="99" required>

  <label id="labelShirtSize" style="display:none;">‡πÑ‡∏ã‡∏™‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠ / Shirt Size</label>
  <select id="shirtSize" style="display:none;">
  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ã‡∏™‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠ --</option>
  <option value="XS">XS 34"</option>
  <option value="S">S 36"</option>
  <option value="M">M 38"</option>
  <option value="L">L 40"</option>
  <option value="XL">XL 42"</option>
  <option value="2XL">2XL 44"</option>
  <option value="3XL">3XL 46"</option>
  <option value="4XL">4XL 48"</option>
</select>

  <label id="labelCategory">‡∏£‡∏∏‡πà‡∏ô‡∏≠‡∏≤‡∏¢‡∏∏/‡πÄ‡∏û‡∏®</label>
  <select id="category" required>
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô --</option>
  </select>

  <label id="labelSlip">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
  <input type="file" id="slip" accept="image/*" required>

  <button type="submit" id="submitBtn">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
  <div id="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</div>
</form>

<div id="resultModal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal()">√ó</button>
    <h2 id="modalTitle">‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ</h2>
    <p id="resultText" style="white-space:pre-line; text-align:left;"></p>
    <img id="slipPreview" src="" alt="slip" style="max-width:220px; border-radius:8px; margin-top:8px;">
    <div style="margin-top:12px;">
      <button onclick="closeModal()" style="background:#3b82f6;color:#fff;padding:8px 14px;border-radius:8px;border:none;">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let categoriesData = [];
let currentLang = "TH";

function isValidThaiId(id){ if(!/^\d{13}$/.test(id))return false; let s=0;for(let i=0;i<12;i++)s+=parseInt(id[i])*(13-i);return(11-s%11)%10===parseInt(id[12]);}
function isPassportFormat(v){if(/^\d{13}$/.test(v))return false;return /^[A-Za-z0-9]{6,15}$/.test(v);}
function detectIdTypeByValue(v){if(isValidThaiId(v))return"thaiid";if(isPassportFormat(v))return"passport";return null;}
function isValidEmail(e){return /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e);}

const TEXT={TH:{formTitle:"‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡πà‡∏á",formSubtitle:"4LAPTOP100",labelFirstName:"‡∏ä‡∏∑‡πà‡∏≠",labelLastName:"‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•",labelIdType:"‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£",labelNationalId:"‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / Passport",idHintThai:"‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å",idHintPassport:"Passport: ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 6‚Äì15 ‡∏ï‡∏±‡∏ß (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß)",idErrorThai:"‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",idErrorPassport:"‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Passport ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (6‚Äì15 ‡∏ï‡∏±‡∏ß ‡∏≠‡∏±‡∏Å‡∏©‡∏£/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)",idErrorGeneric:"‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",labelPhone:"‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",labelEmail:"Email",labelAge:"‡∏≠‡∏≤‡∏¢‡∏∏",labelCategory:"‡∏£‡∏∏‡πà‡∏ô‡∏≠‡∏≤‡∏¢‡∏∏/‡πÄ‡∏û‡∏®",labelSlip:"‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô",submitBtn:"‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",modalTitle:"‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ",duplicateMsg:"‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£/Passport ‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚ùå",uploadError:"‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå",saveError:"‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå",fillFields:"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô"},EN:{formTitle:"Running Registration",formSubtitle:"4LAPTOP100",labelFirstName:"First Name",labelLastName:"Last Name",labelIdType:"Document Type",labelNationalId:"National ID / Passport",idHintThai:"Thai ID: 13 digits",idHintPassport:"Passport: 6‚Äì15 alphanumeric (must include a letter)",idErrorThai:"‚ùå Please enter a valid 13-digit Thai national ID",idErrorPassport:"‚ùå Please enter a valid passport number (6‚Äì15 alphanumeric)",idErrorGeneric:"‚ùå Invalid format",labelPhone:"Phone Number",labelEmail:"Email",labelAge:"Age",labelCategory:"Category (Age / Gender)",labelSlip:"Upload Payment Slip",submitBtn:"Register",modalTitle:"Registration Completed Successfully! ‚úÖ",duplicateMsg:"This National ID / Passport is already registered ‚ùå",uploadError:"Upload slip failed ‚ùå",saveError:"Save failed ‚ùå",fillFields:"Please fill all required fields"}};

function applyLanguageUI(){const t=TEXT[currentLang];document.getElementById("formTitle").innerText=t.formTitle;document.getElementById("formSubtitle").innerText=t.formSubtitle;document.getElementById("labelFirstName").innerText=t.labelFirstName;document.getElementById("labelLastName").innerText=t.labelLastName;document.getElementById("labelIdType").innerText=t.labelIdType;document.getElementById("labelNationalId").innerText=t.labelNationalId;document.getElementById("labelPhone").innerText=t.labelPhone;document.getElementById("labelEmail").innerText=t.labelEmail;document.getElementById("labelAge").innerText=t.labelAge;document.getElementById("labelCategory").innerText=t.labelCategory;document.getElementById("labelSlip").innerText=t.labelSlip;document.getElementById("submitBtn").innerText=t.submitBtn;document.getElementById("modalTitle").innerText=t.modalTitle;document.getElementById("langText").innerText=currentLang;document.getElementById("langFlag").innerText=currentLang==="TH"?"üáπüá≠":"üá¨üáß";renderCategories();updateIdHint();}
function toggleLang(){currentLang=currentLang==="TH"?"EN":"TH";applyLanguageUI();}
async function loadCategories(){try{const{data,error}=await supabaseClient.from("categories").select("*").eq("is_open",!0).order("id",{ascending:!0});if(!error&&data){categoriesData=data;renderCategories()}}catch(e){console.error("loadCategories:",e)}}
function renderCategories(){const e=document.getElementById("category"),t=TEXT[currentLang];e.innerHTML=`<option value="">-- ${t.labelCategory} --</option>`;categoriesData.forEach(a=>{const n=document.createElement("option");n.value=a.value||a.id;n.textContent=currentLang==="TH"?a.name_th||a.name_en:a.name_en||a.name_th;e.appendChild(n)})}
const idTypeSelect=document.getElementById("idType"),nationalIdInput=document.getElementById("nationalId"),idHintElem=document.getElementById("idHint"),idErrorElem=document.getElementById("idError"),submitBtn=document.getElementById("submitBtn"),loadingElem=document.getElementById("loading");
function updateIdHint(){const t=TEXT[currentLang],e=idTypeSelect.value;"thaiid"===e?idHintElem.innerText=t.idHintThai:"passport"===e?idHintElem.innerText=t.idHintPassport:idHintElem.innerText=t.idHintThai+" / "+t.idHintPassport}
function showIdError(e){idErrorElem.style.display="block",idErrorElem.innerText=e,nationalIdInput.style.border="2px solid #ff7b7b",submitBtn.disabled=!0}
function clearIdError(){idErrorElem.style.display="none",idErrorElem.innerText="",nationalIdInput.style.border="",submitBtn.disabled=!1}
nationalIdInput.addEventListener("input",()=>{const e=nationalIdInput.value.trim(),t=idTypeSelect.value,a=TEXT[currentLang];if(""===e)return clearIdError(),void updateIdHint();"auto"===t?detectIdTypeByValue(e)==="thaiid"?(clearIdError(),idHintElem.innerText=a.idHintThai):detectIdTypeByValue(e)==="passport"?(clearIdError(),idHintElem.innerText=a.idHintPassport):showIdError(a.idErrorGeneric):"thaiid"===t?isValidThaiId(e)?clearIdError():showIdError(a.idErrorThai):"passport"===t&&(isPassportFormat(e)?clearIdError():showIdError(a.idErrorPassport))});
idTypeSelect.addEventListener("change",()=>{updateIdHint();nationalIdInput.dispatchEvent(new Event("input"))});
function closeModal(){document.getElementById("resultModal").style.display="none"}

document.getElementById("registerForm").addEventListener("submit",async e=>{
e.preventDefault();
const t=document.getElementById("firstName").value.trim(),n=document.getElementById("lastName").value.trim(),a=nationalIdInput.value.trim(),r=document.getElementById("phone").value.trim(),l=document.getElementById("email").value.trim(),i=document.getElementById("age").value.trim(),d=document.getElementById("shirtSize").value,o=document.getElementById("category").value,s=document.getElementById("slip").files[0],m=TEXT[currentLang];
if(!(t&&n&&a&&r&&l&&i&&o&&s))return void alert(m.fillFields);
if(!isValidEmail(l)){alert(currentLang==="TH"?"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô example@gmail.com":"Please enter a valid email address (e.g. example@gmail.com)");return}
const u=idTypeSelect.value;let c=!1;if("auto"===u?(isValidThaiId(a)||isPassportFormat(a))&&(c=!0):"thaiid"===u?isValidThaiId(a)&&(c=!0):"passport"===u&&isPassportFormat(a)&&(c=!0),c){submitBtn.disabled=!0,loadingElem.style.display="block";try{const{data:e,error:u}=await supabaseClient.from("bangwad").select("national_id").eq("national_id",a);if(u&&console.error("duplicate check error:",u),e&&e.length>0)return alert(m.duplicateMsg),submitBtn.disabled=!1,void(loadingElem.style.display="none");const c=`slip_${Date.now()}_${(s.name||"").replace(/\s+/g,"_")}`,{error:p}=await supabaseClient.storage.from("slips").upload(c,s);if(p)return console.error("uploadError:",p),alert(m.uploadError),submitBtn.disabled=!1,void(loadingElem.style.display="none");const E=`${SUPABASE_URL}/storage/v1/object/public/slips/${encodeURIComponent(c)}`,{error:g}=await supabaseClient.from("bangwad").insert([{first_name:t,last_name:n,national_id:a,phone:r,email:l,age:i,shirt_size:d,category:o,slip_url:E,status:"pending"}]);if(loadingElem.style.display="none",submitBtn.disabled=!1,g)return console.error("insertError:",g),void alert(m.saveError);document.getElementById("resultText").innerText=`${TEXT[currentLang].labelFirstName}: ${t} ${n}\n${TEXT[currentLang].labelAge}: ${i}\n${TEXT[currentLang].labelCategory}: ${o}\n${TEXT[currentLang].labelPhone}: ${r}\nEmail: ${l}`,document.getElementById("slipPreview").src=E,document.getElementById("resultModal").style.display="flex",document.getElementById("registerForm").reset(),updateIdHint()}catch(e){console.error("submit error:",e),alert(TEXT[currentLang].saveError),submitBtn.disabled=!1,loadingElem.style.display="none"}}else alert(m.idErrorGeneric)});
document.addEventListener("DOMContentLoaded",async()=>{applyLanguageUI(),await loadCategories(),updateIdHint()});
  // Lock ‡∏Ñ‡∏•‡∏¥‡πä‡∏Å‡∏Ç‡∏ß‡∏≤
document.addEventListener("contextmenu",function(e){e.preventDefault()});
document.addEventListener("keydown",function(e){("F12"===e.key||e.ctrlKey&&e.shiftKey&&"I"===e.key||e.ctrlKey&&e.shiftKey&&"J"===e.key||e.ctrlKey&&"U"===e.key)&&e.preventDefault()});
</script>
</body>
</html>
