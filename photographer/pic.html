<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photographer Official</title>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  /* ------------------------------------------------
     GLOBAL BACKGROUND (‡∏î‡∏≥‡∏™‡∏ô‡∏¥‡∏ó‡∏ó‡∏∏‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå)
  -------------------------------------------------- */
  html, body {
    margin: 0;
    padding: 0;
    background: #000000 !important;
    overflow: hidden;
    font-family: "Prompt", sans-serif;
  }

  /* ------------------------------------------------
     SPOTLIGHT EFFECT (‡πÑ‡∏°‡πà‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á)
  -------------------------------------------------- */
  .spotlight {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 500px;
    height: 500px;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle,
                rgba(0,120,255,0.15),
                rgba(0,0,0,0) 70%);
    filter: blur(80px);
    opacity: 0.25;
    pointer-events: none;
    z-index: 0;
  }

  /* ------------------------------------------------
     TITLE (‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡∏±‡∏î)
  -------------------------------------------------- */
  .title {
    position: fixed;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 42px;
    font-weight: 900;
    color: #ffffff;
    z-index: 1000;
    text-shadow: 0 0 20px rgba(255,255,255,0.9);
  }

  /* ------------------------------------------------
     CARD STYLE (PC MODE)
  -------------------------------------------------- */
  .card {
    position: absolute;
    width: 150px;
    padding: 4px;
    border-radius: 16px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.25);
    text-align: center;
    backdrop-filter: blur(10px);
    z-index: 10;
  }

  .card img {
    width: 150px;
    height: 150px;
    border-radius: 12px;
    object-fit: cover;
  }

  .name {
    margin-top: 4px;
    color: #fff;
    font-size: 15px;
    font-weight: 700;
    text-shadow: 0px 2px 4px #000;
  }

  /* ------------------------------------------------
     MOBILE RESPONSIVE SIZE
  -------------------------------------------------- */
  @media (max-width: 600px) {
    .card { width: 110px; }
    .card img { width: 110px; height: 110px; }
    .name { font-size: 13px; }
    .title { font-size: 28px; }
  }

  @media (max-width: 400px) {
    .card { width: 90px; }
    .card img { width: 90px; height: 90px; }
    .name { font-size: 12px; }
    .title { font-size: 24px; }
  }
</style>
</head>

<body>

<div class="spotlight"></div>
<h1 class="title">üì∏ Photographer Official</h1>

<script>
/* ----------------------------------------------------
   CONFIG - ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
------------------------------------------------------ */
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co"; 
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics";

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_KEY);

/* ----------------------------------------------------
   GLOBAL STATE
------------------------------------------------------ */
let cards = [];
let dataList = [];

/* ----------------------------------------------------
   GET SAFE POSITION (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏î)
------------------------------------------------------ */
function getSafePosition(cardW, cardH) {
  let attempts = 0;

  while (attempts < 80) {
    const x = Math.random() * (window.innerWidth - cardW - 10);
    const y = 80 + Math.random() * (window.innerHeight - cardH - 120);

    let overlap = false;

    for (let c of cards) {
      if (
        Math.abs(c.x - x) < cardW + 20 &&
        Math.abs(c.y - y) < cardH + 20
      ) {
        overlap = true;
        break;
      }
    }

    if (!overlap) return { x, y };

    attempts++;
  }

  return { x: 30, y: 120 };
}

/* ----------------------------------------------------
   SPAWN CARD FROM DATA
------------------------------------------------------ */
function spawnCard(item) {
  const card = document.createElement("div");
  card.classList.add("card");

  const name = item.display_name || `${item.first_name} ${item.last_name}`;

  card.innerHTML = `
    <img src="${item.picture_url}">
    <div class="name">${name}</div>
  `;

  document.body.appendChild(card);

  const isMobile = window.innerWidth < 600;
  const cardW = isMobile ? (window.innerWidth < 400 ? 90 : 110) : 150;
  const cardH = isMobile ? (window.innerWidth < 400 ? 130 : 150) : 200;

  const pos = getSafePosition(cardW, cardH);

  const obj = {
    el: card,
    x: pos.x,
    y: pos.y,
    vx: (Math.random() * 1.5 - 0.75),
    vy: (Math.random() * 1.5 - 0.75),
    w: cardW + 10,
    h: cardH + 10
  };

  card.style.left = obj.x + "px";
  card.style.top = obj.y + "px";

  cards.push(obj);
}

/* ----------------------------------------------------
   CLEAR CARDS
------------------------------------------------------ */
function clearCards() {
  for (let c of cards) c.el.remove();
  cards = [];
}

/* ----------------------------------------------------
   RENDER ALL APPROVED
------------------------------------------------------ */
function renderAll() {
  clearCards();
  dataList.forEach(spawnCard);
}

/* ----------------------------------------------------
   PHYSICS LOOP (‡∏ä‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á)
------------------------------------------------------ */
function updatePhysics() {
  const W = window.innerWidth;
  const H = window.innerHeight;

  for (let i = 0; i < cards.length; i++) {
    const A = cards[i];

    A.x += A.vx;
    A.y += A.vy;

    if (A.x < 0 || A.x + A.w > W) A.vx *= -1;
    if (A.y < 80 || A.y + A.h > H) A.vy *= -1;

    for (let j = i + 1; j < cards.length; j++) {
      const B = cards[j];

      if (
        A.x < B.x + B.w &&
        A.x + A.w > B.x &&
        A.y < B.y + B.h &&
        A.y + A.h > B.y
      ) {
        let tv = A.vx;
        let ty = A.vy;
        A.vx = B.vx;
        A.vy = B.vy;
        B.vx = tv;
        B.vy = ty;
      }
    }

    A.el.style.left = A.x + "px";
    A.el.style.top = A.y + "px";
  }

  requestAnimationFrame(updatePhysics);
}

/* ----------------------------------------------------
   LOAD INITIAL DATA
------------------------------------------------------ */
async function loadInitial() {
  const { data } = await db
    .from("photographer_registration")
    .select("*")
    .eq("status", "approved");

  dataList = data;
  renderAll();
}

/* ----------------------------------------------------
   REALTIME LISTENER
------------------------------------------------------ */
db.channel("realtime_photographers")
  .on(
    "postgres_changes",
    { event: "*", schema: "public", table: "photographer_registration" },
    async () => {
      const { data } = await db
        .from("photographer_registration")
        .select("*")
        .eq("status", "approved");

      dataList = data;
      renderAll();
    }
  )
  .subscribe();

/* ----------------------------------------------------
   START SYSTEM
------------------------------------------------------ */
loadInitial();
updatePhysics();
</script>

</body>
</html>
