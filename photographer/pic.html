<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photographer Official</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body {
    background: #000000;
    margin: 0;
    overflow-x: hidden;
    font-family: "Prompt", sans-serif;
  }

  .title {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 44px;
    font-weight: 800;
    color: white;
    text-shadow: 0 0 15px rgba(255,255,255,0.9);
    z-index: 100;
    pointer-events: none;
  }

  .gallery {
    position: absolute;
    top: 120px;
    left: 0;
    width: 100%;
    display: grid;
    gap: 30px;
    padding: 40px;
    justify-content: center;
    grid-template-columns: repeat(auto-fill, 160px);
    z-index: 1;
  }

  .card {
    width: 150px;
    text-align: center;
    animation: fadeIn 1s ease;
  }

  .card img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 14px;
    animation: floatY 6s ease-in-out infinite, tilt 6s ease-in-out infinite;
    box-shadow: 0 0 15px rgba(255,255,255,0.4);
  }

  .name {
    color: white;
    font-size: 16px;
    font-weight: 700;
    margin-top: 6px;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes floatY {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-18px); }
    100% { transform: translateY(0px); }
  }

  @keyframes tilt {
    0% { transform: rotate(-1.5deg); }
    50% { transform: rotate(1.5deg); }
    100% { transform: rotate(-1.5deg); }
  }
</style>
</head>

<body>

<h1 class="title">ðŸ“¸ Photographer Official</h1>

<div id="gallery" class="gallery"></div>

<script>
/* -----------------------------------------
   CONFIG
--------------------------------------------*/
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co"; // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics";                  // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_KEY);

/* -----------------------------------------
   LOAD INITIAL DATA
--------------------------------------------*/
async function loadData() {
  const { data } = await db
    .from("photographer_registration")
    .select("*")
    .eq("status", "approved");

  renderGallery(data);
}

/* -----------------------------------------
   RENDER GALLERY (SHOW ALL, NO DUPLICATE)
--------------------------------------------*/
function renderGallery(list) {
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = ""; // clear à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸à¹ˆà¸­à¸™

  list.forEach(item => {
    if (!item.picture_url) return;

    const name = item.display_name || `${item.first_name} ${item.last_name}`;

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <img src="${item.picture_url}">
      <div class="name">${name}</div>
    `;

    gallery.appendChild(card);
  });
}

/* -----------------------------------------
   REALTIME SUBSCRIBE
--------------------------------------------*/
db.channel("realtime-photographers")
  .on(
    "postgres_changes",
    {
      event: "*",
      schema: "public",
      table: "photographer_registration",
    },
    async (payload) => {
      console.log("Realtime:", payload);

      // Reload approved data only
      const { data } = await db
        .from("photographer_registration")
        .select("*")
        .eq("status", "approved");

      renderGallery(data);
    }
  )
  .subscribe();

/* -----------------------------------------
   START
--------------------------------------------*/
loadData();
</script>

</body>
</html>
