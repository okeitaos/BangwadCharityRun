<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photographer Official</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body {
    background: #000000;
    margin: 0;
    overflow: hidden;
    font-family: "Prompt";
  }

  .title {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 42px;
    color: #ffffff;
    font-weight: 800;
    text-shadow: 0 0 20px rgba(255,255,255,0.7);
    z-index: 1000;
  }

  .card {
    position: absolute;
    width: 150px;
    padding: 4px;
    border-radius: 16px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    text-align: center;
    z-index: 10;
  }

  .card img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 12px;
  }

  .name {
    color: #fff;
    font-weight: 700;
    margin-top: 5px;
    font-size: 15px;
    text-shadow: 0px 2px 4px #000;
  }
</style>
</head>

<body>

<h1 class="title">üì∏ Photographer Official</h1>

<script>
/* ----------------------------------------------------
   CONFIG
-----------------------------------------------------*/
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics";                  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_KEY);

/* ----------------------------------------------------
   GLOBAL STATE
-----------------------------------------------------*/
let cards = [];   // physics objects
let dataList = []; // all approved rows

/* ----------------------------------------------------
   SAFE POSITION (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏î)
-----------------------------------------------------*/
function getSafePosition() {
  let attempt = 0;

  while (attempt < 80) {
    let x = Math.random() * (window.innerWidth - 200);
    let y = 120 + Math.random() * (window.innerHeight - 260);

    let overlap = false;

    for (let c of cards) {
      if (
        Math.abs(c.x - x) < 170 &&
        Math.abs(c.y - y) < 210
      ) {
        overlap = true;
        break;
      }
    }

    if (!overlap) return { x, y };

    attempt++;
  }

  return { x: 50, y: 150 };
}

/* ----------------------------------------------------
   SPAWN CARD
-----------------------------------------------------*/
function spawnCard(item) {
  const card = document.createElement("div");
  card.classList.add("card");

  const name = item.display_name || `${item.first_name} ${item.last_name}`;

  card.innerHTML = `
    <img src="${item.picture_url}">
    <div class="name">${name}</div>
  `;

  document.body.appendChild(card);

  const pos = getSafePosition();

  const obj = {
    el: card,
    x: pos.x,
    y: pos.y,
    vx: (Math.random() * 2 - 1) * 0.8,
    vy: (Math.random() * 2 - 1) * 0.8,
    w: 160,
    h: 200,
  };

  card.style.left = obj.x + "px";
  card.style.top = obj.y + "px";

  cards.push(obj);
}

/* ----------------------------------------------------
   REMOVE OLD CARDS FROM DOM
-----------------------------------------------------*/
function clearCards() {
  for (let c of cards) c.el.remove();
  cards = [];
}

/* ----------------------------------------------------
   RENDER ALL APPROVED PHOTOS
-----------------------------------------------------*/
function renderAll() {
  clearCards();
  dataList.forEach(spawnCard);  
}

/* ----------------------------------------------------
   PHYSICS UPDATE (‡∏ä‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á)
-----------------------------------------------------*/
function updatePhysics() {
  const W = window.innerWidth;
  const H = window.innerHeight;

  for (let i = 0; i < cards.length; i++) {
    const A = cards[i];

    A.x += A.vx;
    A.y += A.vy;

    if (A.x < 0 || A.x + A.w > W) A.vx *= -1;
    if (A.y < 100 || A.y + A.h > H) A.vy *= -1;

    for (let j = i + 1; j < cards.length; j++) {
      const B = cards[j];

      if (
        A.x < B.x + B.w &&
        A.x + A.w > B.x &&
        A.y < B.y + B.h &&
        A.y + A.h > B.y
      ) {
        let tv = A.vx;
        let ty = A.vy;

        A.vx = B.vx;
        A.vy = B.vy;

        B.vx = tv;
        B.vy = ty;
      }
    }

    A.el.style.left = A.x + "px";
    A.el.style.top = A.y + "px";
  }

  requestAnimationFrame(updatePhysics);
}

/* ----------------------------------------------------
   LOAD INITIAL APPROVED
-----------------------------------------------------*/
async function loadInitial() {
  const { data } = await db
    .from("photographer_registration")
    .select("*")
    .eq("status", "approved");

  dataList = data;
  renderAll();
}

/* ----------------------------------------------------
   REALTIME LISTENER
-----------------------------------------------------*/
db.channel("realtime_photographers")
  .on(
    "postgres_changes",
    { event: "*", schema: "public", table: "photographer_registration" },
    async () => {
      const { data } = await db
        .from("photographer_registration")
        .select("*")
        .eq("status", "approved");

      dataList = data;
      renderAll(); // ‡∏£‡∏µ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    }
  )
  .subscribe();

/* ----------------------------------------------------
   START SYSTEM
-----------------------------------------------------*/
loadInitial();
updatePhysics();
</script>

</body>
</html>
