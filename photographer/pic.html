<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photographer Official</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body {
    background: #000000;
    margin: 0;
    overflow: hidden;
    font-family: "Prompt";
  }

  .title {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 32px;
    color: #ffffff;
    font-weight: 800;
    z-index: 1000;
    text-shadow: 0 0 20px rgba(255,255,255,0.7);
  }

  .card {
    position: absolute;
    width: 120px;
    padding: 3px;
    border-radius: 14px;
    background: rgba(255,255,255,0.10);
    border: 1px solid rgba(255,255,255,0.25);
    backdrop-filter: blur(10px);
    text-align: center;
    z-index: 10;
  }

  .card img {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 12px;
  }

  .name {
    color: #fff;
    font-weight: 700;
    margin-top: 4px;
    font-size: 14px;
    text-shadow: 0px 2px 4px #000;
  }

  /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 380px) */
  @media (max-width: 380px) {
    .card {
      width: 100px;
    }
    .card img {
      width: 100px;
      height: 100px;
    }
    .name {
      font-size: 12px;
    }
    .title {
      font-size: 26px;
    }
  }
</style>

</head>

<body>

<h1 class="title">üì∏ Photographer Official</h1>

<script>
/* ----------------------------------------------------
   CONFIG
-----------------------------------------------------*/
const SUPABASE_URL = "https://xjdjurdflowiwdxgkvfr.supabase.co"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqZGp1cmRmbG93aXdkeGdrdmZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDk5OTEsImV4cCI6MjA2OTg4NTk5MX0.QtWt1IrY1UYKmj0spL3T8CkaQh9wq2P-_4b6eWB3ics";                  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_KEY);

/* ----------------------------------------------------
   GLOBAL STATE
-----------------------------------------------------*/
let cards = [];   // physics objects
let dataList = []; // all approved rows

/* ----------------------------------------------------
   SAFE POSITION (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏î)
-----------------------------------------------------*/
function getSafePosition() {
  let attempt = 0;
  const padding = 20; // ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û

  const cardW = window.innerWidth < 480 ? 120 : 150;
  const cardH = window.innerWidth < 480 ? 160 : 200;

  while (attempt < 120) {
    let x = Math.random() * (window.innerWidth - cardW - 20);
    let y = 80 + Math.random() * (window.innerHeight - cardH - 100);

    let overlap = false;

    for (let c of cards) {
      if (
        Math.abs(c.x - x) < cardW + padding &&
        Math.abs(c.y - y) < cardH + padding
      ) {
        overlap = true;
        break;
      }
    }

    if (!overlap) {
      return { x, y };
    }

    attempt++;
  }

  // fallback: ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢
  const col = cards.length % 3;
  const row = Math.floor(cards.length / 3);

  return {
    x: 30 + col * (cardW + 15),
    y: 100 + row * (cardH + 20)
  };
}

/* ----------------------------------------------------
   SPAWN CARD
-----------------------------------------------------*/
function spawnCard(item) {
  const card = document.createElement("div");
  card.classList.add("card");

  const name = item.display_name || `${item.first_name} ${item.last_name}`;

  card.innerHTML = `
    <img src="${item.picture_url}">
    <div class="name">${name}</div>
  `;

  document.body.appendChild(card);

  const pos = getSafePosition();

  const obj = {
    el: card,
    x: pos.x,
    y: pos.y,
    vx: (Math.random() * 2 - 1) * 0.8,
    vy: (Math.random() * 2 - 1) * 0.8,
    w: 160,
    h: 200,
  };

  card.style.left = obj.x + "px";
  card.style.top = obj.y + "px";

  cards.push(obj);
}

/* ----------------------------------------------------
   REMOVE OLD CARDS FROM DOM
-----------------------------------------------------*/
function clearCards() {
  for (let c of cards) c.el.remove();
  cards = [];
}

/* ----------------------------------------------------
   RENDER ALL APPROVED PHOTOS
-----------------------------------------------------*/
function renderAll() {
  clearCards();
  dataList.forEach(spawnCard);  
}

/* ----------------------------------------------------
   PHYSICS UPDATE (‡∏ä‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á)
-----------------------------------------------------*/
function updatePhysics() {
  const W = window.innerWidth;
  const H = window.innerHeight;

  for (let i = 0; i < cards.length; i++) {
    const A = cards[i];

    A.x += A.vx;
    A.y += A.vy;

    if (A.x < 0 || A.x + A.w > W) A.vx *= -1;
    if (A.y < 100 || A.y + A.h > H) A.vy *= -1;

    for (let j = i + 1; j < cards.length; j++) {
      const B = cards[j];

      if (
        A.x < B.x + B.w &&
        A.x + A.w > B.x &&
        A.y < B.y + B.h &&
        A.y + A.h > B.y
      ) {
        let tv = A.vx;
        let ty = A.vy;

        A.vx = B.vx;
        A.vy = B.vy;

        B.vx = tv;
        B.vy = ty;
      }
    }

    A.el.style.left = A.x + "px";
    A.el.style.top = A.y + "px";
  }

  requestAnimationFrame(updatePhysics);
}

/* ----------------------------------------------------
   LOAD INITIAL APPROVED
-----------------------------------------------------*/
async function loadInitial() {
  const { data } = await db
    .from("photographer_registration")
    .select("*")
    .eq("status", "approved");

  dataList = data;
  renderAll();
}

/* ----------------------------------------------------
   REALTIME LISTENER
-----------------------------------------------------*/
db.channel("realtime_photographers")
  .on(
    "postgres_changes",
    { event: "*", schema: "public", table: "photographer_registration" },
    async () => {
      const { data } = await db
        .from("photographer_registration")
        .select("*")
        .eq("status", "approved");

      dataList = data;
      renderAll(); // ‡∏£‡∏µ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    }
  )
  .subscribe();

/* ----------------------------------------------------
   START SYSTEM
-----------------------------------------------------*/
loadInitial();
updatePhysics();
</script>

</body>
</html>
