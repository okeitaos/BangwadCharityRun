<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>ThaiRun Face Sync ‚Äì PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-white min-h-screen p-6">

<div id="app" class="max-w-6xl mx-auto space-y-6">

  <!-- HEADER -->
  <h1 class="text-4xl font-bold text-yellow-400 text-center">
    üß† ThaiRun Face Sync ‚Äì PRO
  </h1>

  <!-- STATUS -->
  <div class="bg-slate-800 rounded-xl p-6 grid md:grid-cols-4 gap-4 text-center">
    <div>
      <div class="text-gray-400 text-sm">Total</div>
      <div id="total" class="text-3xl font-bold">0</div>
    </div>
    <div>
      <div class="text-gray-400 text-sm">Synced</div>
      <div id="synced" class="text-3xl font-bold text-green-400">0</div>
    </div>
    <div>
      <div class="text-gray-400 text-sm">Remaining</div>
      <div id="remaining" class="text-3xl font-bold text-red-400">0</div>
    </div>
    <div>
      <div class="text-gray-400 text-sm">Rate</div>
      <div id="rate" class="text-3xl font-bold">0 / min</div>
    </div>
  </div>

  <!-- PROGRESS -->
  <div class="bg-slate-800 rounded-xl p-4 space-y-2">
    <div class="flex justify-between text-sm text-gray-300">
      <div id="statusText">Idle</div>
      <div id="percentText">0%</div>
    </div>
    <div class="w-full bg-gray-700 rounded-full h-4">
      <div id="progressBar" class="bg-green-400 h-4 rounded-full transition-all"></div>
    </div>
    <div class="text-sm text-gray-400">
      Elapsed: <span id="elapsed">0s</span>
    </div>
  </div>

  <!-- CONTROLS -->
  <div class="flex flex-wrap gap-3 justify-center">
    <button onclick="startSync()" class="bg-green-600 px-5 py-2 rounded">‚ñ∂ Start</button>
    <button onclick="pauseSync()" class="bg-yellow-500 px-5 py-2 rounded">‚è∏ Pause</button>
    <button onclick="resumeSync()" class="bg-green-500 px-5 py-2 rounded">‚ñ∂ Resume</button>
    <button onclick="stopSync()" class="bg-red-600 px-5 py-2 rounded">‚èπ Stop</button>
    <button onclick="refreshStatus()" class="bg-blue-600 px-5 py-2 rounded">üîÑ Refresh</button>
    <button onclick="toggleBig()" class="bg-purple-600 px-5 py-2 rounded">üñ• Big Screen</button>
  </div>

  <!-- PER PHOTOGRAPHER -->
  <div class="bg-slate-800 rounded-xl p-4">
    <h2 class="font-bold mb-2">üì∑ Remaining per Photographer</h2>
    <div id="photographerList" class="grid md:grid-cols-2 gap-2 text-sm"></div>
  </div>

  <!-- LOG -->
  <div class="bg-slate-800 rounded-xl p-4 h-64 overflow-auto text-sm" id="logBox"></div>

</div>

<script>
// const API = "http://localhost:3000";
  const API_BASE = "http://192.168.1.18:3000";

let syncing = false;
let paused = false;
let startTime = null;
let lastSynced = 0;

function log(msg) {
  const box = document.getElementById("logBox");
  box.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${msg}</div>`;
  box.scrollTop = box.scrollHeight;
}

async function startSync() {
  syncing = true;
  paused = false;
  startTime = Date.now();
  lastSynced = 0;
  log("üöÄ Start Sync");
  statusText.innerText = "Syncing‚Ä¶";
  loopSync();
  pollStatus();
}

function pauseSync() {
  paused = true;
  log("‚è∏ Paused");
  statusText.innerText = "Paused";
}

function resumeSync() {
  if (!syncing) return;
  paused = false;
  log("‚ñ∂ Resume");
  statusText.innerText = "Syncing‚Ä¶";
}

function stopSync() {
  syncing = false;
  paused = false;
  log("‚èπ Stopped");
  statusText.innerText = "Stopped";
}

async function loopSync() {
  if (!syncing) return;
  if (!paused) await fetch(API + "/sync", { method: "POST" });
  setTimeout(loopSync, 800);
}

async function pollStatus() {
  if (!syncing) return;

  const res = await fetch(API + "/sync/status");
  const d = await res.json();

  total.innerText = d.total;
  synced.innerText = d.synced;
  remaining.innerText = d.remaining;

  const percent = d.total ? Math.round((d.synced / d.total) * 100) : 0;
  progressBar.style.width = percent + "%";
  percentText.innerText = percent + "%";

  const elapsed = Math.floor((Date.now() - startTime) / 1000);
  elapsedEl.innerText = elapsed + "s";

  const rate = d.synced - lastSynced;
  rateEl.innerText = rate * 60 + " / min";
  lastSynced = d.synced;

  if (d.done) {
    syncing = false;
    log("üéâ Completed");
    statusText.innerText = "Completed";
  } else {
    setTimeout(pollStatus, 1200);
  }
}

function refreshStatus() {
  log("üîÑ Refresh");
  pollStatus();
}

function toggleBig() {
  document.body.classList.toggle("text-2xl");
  log("üñ• Toggle Big Screen");
}
</script>

</body>
</html>
